<svg width="1280" height="720" viewBox="0 0 1280 720" fill="none" xmlns="http://www.w3.org/2000/svg" role="img" aria-labelledby="title desc">
  <title id="title">MCP HTTP Session Flow</title>
  <desc id="desc">Sequence-style flow showing initialize, session header capture, workspace setup, rebuild, and query loop.</desc>

  <defs>
    <linearGradient id="bg" x1="0" y1="0" x2="1280" y2="720" gradientUnits="userSpaceOnUse">
      <stop stop-color="#F8FAFC"/>
      <stop offset="1" stop-color="#EEF2FF"/>
    </linearGradient>
    <linearGradient id="card" x1="0" y1="0" x2="1" y2="1">
      <stop stop-color="#FFFFFF"/>
      <stop offset="1" stop-color="#F8FAFC"/>
    </linearGradient>
    <marker id="arrow" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="8" markerHeight="8" orient="auto-start-reverse">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#334155"/>
    </marker>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="0" dy="8" stdDeviation="10" flood-color="#0F172A" flood-opacity="0.10"/>
    </filter>
    <style>
      .label { font: 600 18px Inter, Segoe UI, Arial, sans-serif; fill: #0F172A; }
      .sub { font: 500 14px Inter, Segoe UI, Arial, sans-serif; fill: #334155; }
      .step { font: 600 16px Inter, Segoe UI, Arial, sans-serif; fill: #0F172A; }
      .meta { font: 500 13px Inter, Segoe UI, Arial, sans-serif; fill: #475569; }
      .cap { font: 700 24px Inter, Segoe UI, Arial, sans-serif; fill: #111827; }
    </style>
  </defs>

  <rect x="0" y="0" width="1280" height="720" fill="url(#bg)"/>
  <text x="60" y="68" class="cap">MCP HTTP Session Flow</text>
  <text x="60" y="98" class="sub">Session-scoped workspace context with required mcp-session-id propagation</text>

  <g filter="url(#shadow)">
    <rect x="80" y="130" rx="16" ry="16" width="360" height="520" fill="url(#card)" stroke="#CBD5E1"/>
    <rect x="840" y="130" rx="16" ry="16" width="360" height="520" fill="url(#card)" stroke="#CBD5E1"/>
  </g>

  <text x="240" y="180" text-anchor="middle" class="label">MCP Client</text>
  <text x="1020" y="180" text-anchor="middle" class="label">Code Graph Server</text>

  <line x1="260" y1="200" x2="260" y2="630" stroke="#94A3B8" stroke-width="2" stroke-dasharray="6 6"/>
  <line x1="1020" y1="200" x2="1020" y2="630" stroke="#94A3B8" stroke-width="2" stroke-dasharray="6 6"/>

  <line x1="300" y1="250" x2="980" y2="250" stroke="#334155" stroke-width="3" marker-end="url(#arrow)"/>
  <text x="640" y="238" text-anchor="middle" class="step">1) POST initialize</text>

  <line x1="980" y1="310" x2="300" y2="310" stroke="#334155" stroke-width="3" marker-end="url(#arrow)"/>
  <text x="640" y="298" text-anchor="middle" class="step">2) Return mcp-session-id header</text>

  <line x1="300" y1="370" x2="980" y2="370" stroke="#334155" stroke-width="3" marker-end="url(#arrow)"/>
  <text x="640" y="358" text-anchor="middle" class="step">3) graph_set_workspace (+ mcp-session-id)</text>

  <line x1="980" y1="430" x2="300" y2="430" stroke="#334155" stroke-width="3" marker-end="url(#arrow)"/>
  <text x="640" y="418" text-anchor="middle" class="step">4) graph_rebuild â†’ status: QUEUED</text>

  <line x1="300" y1="490" x2="980" y2="490" stroke="#334155" stroke-width="3" marker-end="url(#arrow)"/>
  <text x="640" y="478" text-anchor="middle" class="step">5) graph_query / graph_health</text>

  <line x1="980" y1="550" x2="300" y2="550" stroke="#334155" stroke-width="3" marker-end="url(#arrow)"/>
  <text x="640" y="538" text-anchor="middle" class="step">6) Shaped response (compact/balanced/debug)</text>

  <rect x="60" y="662" width="1160" height="36" rx="10" fill="#E2E8F0"/>
  <text x="640" y="685" text-anchor="middle" class="meta">All non-initialize MCP calls in HTTP mode must include the same mcp-session-id for that client session.</text>
</svg>
