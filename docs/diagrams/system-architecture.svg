<svg width="1400" height="860" viewBox="0 0 1400 860" fill="none" xmlns="http://www.w3.org/2000/svg" role="img" aria-labelledby="title desc">
  <title id="title">Code Graph Server System Architecture</title>
  <desc id="desc">Architecture diagram showing MCP client, MCP server, tool handlers, graph orchestrator, response shaper, Memgraph, vector store, and hybrid retriever flow.</desc>

  <defs>
    <linearGradient id="bg" x1="0" y1="0" x2="1400" y2="860" gradientUnits="userSpaceOnUse">
      <stop stop-color="#F8FAFC"/>
      <stop offset="1" stop-color="#ECFEFF"/>
    </linearGradient>
    <linearGradient id="box" x1="0" y1="0" x2="1" y2="1">
      <stop stop-color="#FFFFFF"/>
      <stop offset="1" stop-color="#F1F5F9"/>
    </linearGradient>
    <marker id="arrow" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="8" markerHeight="8" orient="auto-start-reverse">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#334155"/>
    </marker>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="0" dy="8" stdDeviation="8" flood-color="#0F172A" flood-opacity="0.12"/>
    </filter>
    <style>
      .title { font: 700 30px Inter, Segoe UI, Arial, sans-serif; fill: #0F172A; }
      .subtitle { font: 500 16px Inter, Segoe UI, Arial, sans-serif; fill: #334155; }
      .label { font: 700 18px Inter, Segoe UI, Arial, sans-serif; fill: #0F172A; }
      .sub { font: 500 13px Inter, Segoe UI, Arial, sans-serif; fill: #475569; }
      .small { font: 600 12px Inter, Segoe UI, Arial, sans-serif; fill: #334155; }
    </style>
  </defs>

  <rect x="0" y="0" width="1400" height="860" fill="url(#bg)"/>
  <text x="60" y="70" class="title">Code Graph Server â€” System Architecture</text>
  <text x="60" y="100" class="subtitle">MCP-native orchestration with graph memory, hybrid retrieval, and response shaping</text>

  <!-- Client -->
  <g filter="url(#shadow)">
    <rect x="80" y="320" width="240" height="110" rx="16" fill="url(#box)" stroke="#CBD5E1"/>
  </g>
  <text x="200" y="365" text-anchor="middle" class="label">Agent / Client</text>
  <text x="200" y="390" text-anchor="middle" class="sub">Copilot, MCP CLI, orchestrator</text>

  <!-- MCP Server -->
  <g filter="url(#shadow)">
    <rect x="390" y="300" width="260" height="150" rx="16" fill="url(#box)" stroke="#93C5FD"/>
  </g>
  <text x="520" y="355" text-anchor="middle" class="label">MCP Server</text>
  <text x="520" y="380" text-anchor="middle" class="sub">HTTP / stdio transport</text>

  <!-- Tool Handlers -->
  <g filter="url(#shadow)">
    <rect x="730" y="210" width="260" height="120" rx="16" fill="url(#box)" stroke="#A7F3D0"/>
  </g>
  <text x="860" y="255" text-anchor="middle" class="label">Tool Handlers</text>
  <text x="860" y="280" text-anchor="middle" class="sub">Tool routing + execution</text>

  <!-- Response Shaper -->
  <g filter="url(#shadow)">
    <rect x="730" y="380" width="260" height="120" rx="16" fill="url(#box)" stroke="#DDD6FE"/>
  </g>
  <text x="860" y="425" text-anchor="middle" class="label">Response Shaper</text>
  <text x="860" y="450" text-anchor="middle" class="sub">compact / balanced / debug</text>

  <!-- Graph Orchestrator -->
  <g filter="url(#shadow)">
    <rect x="1060" y="210" width="260" height="120" rx="16" fill="url(#box)" stroke="#FDE68A"/>
  </g>
  <text x="1190" y="255" text-anchor="middle" class="label">Graph Orchestrator</text>
  <text x="1190" y="280" text-anchor="middle" class="sub">Indexing + rebuild pipeline</text>

  <!-- Hybrid Retriever -->
  <g filter="url(#shadow)">
    <rect x="1060" y="380" width="260" height="120" rx="16" fill="url(#box)" stroke="#FBCFE8"/>
  </g>
  <text x="1190" y="425" text-anchor="middle" class="label">Hybrid Retriever</text>
  <text x="1190" y="450" text-anchor="middle" class="sub">Vector + BM25 + Graph + RRF</text>

  <!-- Memgraph -->
  <g filter="url(#shadow)">
    <rect x="1010" y="610" width="170" height="110" rx="55" fill="url(#box)" stroke="#10B981" stroke-width="2"/>
  </g>
  <text x="1095" y="660" text-anchor="middle" class="label">Memgraph</text>
  <text x="1095" y="684" text-anchor="middle" class="small">Code + temporal graph</text>

  <!-- Vector -->
  <g filter="url(#shadow)">
    <rect x="1210" y="610" width="170" height="110" rx="55" fill="url(#box)" stroke="#0EA5E9" stroke-width="2"/>
  </g>
  <text x="1295" y="660" text-anchor="middle" class="label">Vector Store</text>
  <text x="1295" y="684" text-anchor="middle" class="small">Qdrant-compatible</text>

  <!-- arrows -->
  <line x1="320" y1="375" x2="390" y2="375" stroke="#334155" stroke-width="3" marker-end="url(#arrow)"/>
  <line x1="650" y1="350" x2="730" y2="270" stroke="#334155" stroke-width="3" marker-end="url(#arrow)"/>
  <line x1="650" y1="400" x2="730" y2="440" stroke="#334155" stroke-width="3" marker-end="url(#arrow)"/>

  <line x1="990" y1="270" x2="1060" y2="270" stroke="#334155" stroke-width="3" marker-end="url(#arrow)"/>
  <line x1="990" y1="440" x2="1060" y2="440" stroke="#334155" stroke-width="3" marker-end="url(#arrow)"/>

  <line x1="860" y1="500" x2="860" y2="555" stroke="#334155" stroke-width="3" marker-end="url(#arrow)"/>
  <line x1="860" y1="555" x2="1095" y2="555" stroke="#334155" stroke-width="3"/>
  <line x1="1095" y1="555" x2="1095" y2="610" stroke="#334155" stroke-width="3" marker-end="url(#arrow)"/>

  <line x1="1190" y1="500" x2="1190" y2="555" stroke="#334155" stroke-width="3" marker-end="url(#arrow)"/>
  <line x1="1190" y1="555" x2="1295" y2="555" stroke="#334155" stroke-width="3"/>
  <line x1="1295" y1="555" x2="1295" y2="610" stroke="#334155" stroke-width="3" marker-end="url(#arrow)"/>

  <line x1="730" y1="440" x2="650" y2="420" stroke="#334155" stroke-width="3" marker-end="url(#arrow)"/>
  <line x1="650" y1="420" x2="650" y2="375" stroke="#334155" stroke-width="3"/>
  <line x1="650" y1="375" x2="320" y2="375" stroke="#334155" stroke-width="3" marker-end="url(#arrow)"/>

  <rect x="60" y="790" width="1280" height="42" rx="12" fill="#E2E8F0"/>
  <text x="700" y="816" text-anchor="middle" class="sub">Natural queries are fused via Hybrid Retriever; responses are shaped by profile budget before returning to the client.</text>
</svg>
